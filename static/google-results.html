<!doctype html>
<html lang="en">
    <head>
        <meta charset="utf-8" />
        <meta name="viewport" content="width=device-width,initial-scale=1" />
        <title>Google Results Render</title>
        <style>
            /* small page wrapper so content is centered */
            body {
                margin: 0;
                background: #f6f7f8;
                font-family: Arial, Helvetica, sans-serif;
                color: #202124;
                min-height: 100vh;
                display: flex;
                align-items: flex-start;
                justify-content: center;
                padding: 24px;
                box-sizing: border-box;
            }

            #app {
                width: 100%;
                max-width: 1200px;
            }

            header.page-header {
                display: flex;
                align-items: center;
                justify-content: space-between;
                gap: 12px;
                margin-bottom: 16px;
            }

            header.page-header h1 {
                font-size: 18px;
                margin: 0;
            }

            footer.small {
                font-size: 12px;
                color: #616161;
                margin-top: 18px;
                text-align: center;
            }
        </style>
    </head>

    <body>
        <div id="app">
            <header class="page-header">
                <h1>Mock Google Search — Test Page</h1>
                <div class="muted">Using your provided JSON</div>
            </header>
            <!-- The render function will populate this container -->
        </div>

        <script>
            function renderGoogleMock(json, options = {}) {
                const { containerId } = options;

                if (!document.getElementById("mock-google-styles")) {
                    const style = document.createElement("style");
                    style.id = "mock-google-styles";
                    style.textContent = `
      .mock-google {
        font-family: Arial, Helvetica, sans-serif;
        color: #202124;
        padding: 20px;
        box-sizing: border-box;
        max-width: 1100px;
        margin: 0 auto;
        line-height: 1.35;
        background: white;
        border-radius: 8px;
      }
      .mock-google__grid {
        display: grid;
        grid-template-columns: 1fr 320px;
        gap: 24px;
        align-items: start;
      }
      @media (max-width: 900px) {
        .mock-google__grid { grid-template-columns: 1fr; }
      }

      /* Search header */
      .mg-header {
        display:flex;
        align-items:center;
        gap:12px;
        margin-bottom: 14px;
      }
      .mg-searchbox {
        flex:1;
        border: 1px solid #dfe1e5;
        padding: 10px 12px;
        border-radius: 24px;
        display:flex;
        gap:8px;
        align-items:center;
        background: white;
      }
      .mg-searchbox input {
        border: none;
        outline: none;
        font-size: 15px;
        flex:1;
      }
      .mg-search-count {
        color: #5f6368;
        font-size: 13px;
      }

      /* Organic results */
      .mg-results { margin-top: 6px; }
      .mg-result {
        padding: 12px 0;
        border-bottom: 1px solid #eee;
      }
      .mg-result__title {
        font-size: 18px;
        margin: 0;
        line-height: 1.2;
      }
      .mg-result__title a { color: #1a0dab; text-decoration: none; }
      .mg-result__meta { color: #006621; font-size: 13px; margin-top: 2px; }
      .mg-result__snippet { color: #4d5156; font-size: 14px; margin-top: 6px; }

      /* Knowledge panel */
      .mg-knowledge {
        border-left: 1px solid transparent;
        padding: 12px;
        background: #fbfbfb;
        border-radius: 8px;
        box-shadow: 0 1px 2px rgba(60,64,67,0.08);
      }
      .mg-knowledge__title { font-weight: 600; font-size: 20px; margin: 0 0 8px 0; display:flex; gap:10px; align-items:center; }
      .mg-knowledge__img { width:72px; height:72px; object-fit:cover; border-radius:8px; border:1px solid #e6e6e6; }
      .mg-knowledge__desc { font-size: 14px; color: #3c4043; margin-bottom: 8px; }
      .mg-knowledge__attributes { font-size: 13px; color:#3c4043; margin-top:10px; }
      .mg-knowledge__attributes dt { font-weight:600; }
      .mg-knowledge__attributes dd { margin: 0 0 8px 0; }

      /* Top stories */
      .mg-topstories { margin-top: 8px; display:flex; flex-direction:column; gap:8px; }
      .mg-story { border: 1px solid #e9e9e9; padding:8px; border-radius:6px; background:white; }
      .mg-story a { color: #1a0dab; text-decoration:none; font-weight:600; display:block; }
      .mg-story__meta { font-size:12px; color:#5f6368; margin-top:4px; }

      /* Related searches */
      .mg-related { margin-top: 18px; display:flex; flex-wrap:wrap; gap:8px; }
      .mg-chip {
        background:#f1f3f4;
        border-radius: 16px;
        padding:6px 10px;
        font-size:13px;
        text-decoration:none;
        color:#202124;
        display:inline-block;
      }

      /* small helpers */
      .muted { color:#5f6368; font-size:13px; }
      `;
                    document.head.appendChild(style);
                }

                function el(tag, attrs = {}, ...children) {
                    const node = document.createElement(tag);
                    for (const [k, v] of Object.entries(attrs)) {
                        if (k === "class") node.className = v;
                        else if (k === "html") node.innerHTML = v;
                        else node.setAttribute(k, v);
                    }
                    for (const c of children.flat()) {
                        if (c == null || c === false) continue;
                        node.append(
                            typeof c === "string"
                                ? document.createTextNode(c)
                                : c,
                        );
                    }
                    return node;
                }

                const container = el("div", {
                    class: "mock-google",
                    role: "main",
                    "aria-label": `Search results for ${json.searchParameters?.q || ""}`,
                });

                const header = el(
                    "div",
                    { class: "mg-header" },
                    el(
                        "div",
                        {
                            class: "mg-searchbox",
                            role: "search",
                            "aria-label": "Search box",
                        },
                        el(
                            "svg",
                            {
                                width: "18",
                                height: "18",
                                viewBox: "0 0 24 24",
                                "aria-hidden": "true",
                            },
                            el("path", {
                                d: "M15.5 14h-.79l-.28-.27A6.471 6.471 0 0016 9.5 6.5 6.5 0 109.5 16c1.61 0 3.09-.59 4.23-1.57l.27.28v.79l5 4.99L20.49 19l-4.99-5zM10 14a4 4 0 110-8 4 4 0 010 8z",
                            }),
                        ),
                        el("input", {
                            type: "text",
                            disabled: "true",
                            value: json.searchParameters?.q || "",
                            "aria-label": "Search terms",
                        }),
                        el(
                            "div",
                            { class: "mg-search-count muted" },
                            `${json.organic?.length ?? 0} results`,
                        ),
                    ),
                );
                container.appendChild(header);

                // Grid: left results and right knowledge panel
                const grid = el("div", { class: "mock-google__grid" });

                // Left column
                const left = el("div");

                // Top stories
                if (Array.isArray(json.topStories) && json.topStories.length) {
                    const topBox = el(
                        "section",
                        {
                            class: "mg-topstories",
                            "aria-labelledby": "mg-topstories-title",
                        },
                        el(
                            "h3",
                            { id: "mg-topstories-title", class: "muted" },
                            "Top stories",
                        ),
                    );
                    json.topStories.forEach((story) => {
                        const s = el(
                            "article",
                            { class: "mg-story" },
                            el(
                                "a",
                                {
                                    href: story.link,
                                    target: "_blank",
                                    rel: "noopener noreferrer",
                                },
                                story.title,
                            ),
                            el(
                                "div",
                                { class: "mg-story__meta" },
                                `${story.source || ""}${story.date ? " • " + story.date : ""}`,
                            ),
                        );
                        topBox.appendChild(s);
                    });
                    left.appendChild(topBox);
                }

                // Organic results
                const results = el("section", {
                    class: "mg-results",
                    "aria-label": "Search results",
                });
                if (Array.isArray(json.organic) && json.organic.length) {
                    json.organic.forEach((r) => {
                        const titleLink = el(
                            "a",
                            {
                                href: r.link,
                                target: "_blank",
                                rel: "noopener noreferrer",
                            },
                            r.title,
                        );
                        const meta = r.link
                            ? el("div", { class: "mg-result__meta" }, r.link)
                            : null;
                        const snippet = r.snippet
                            ? el(
                                  "div",
                                  { class: "mg-result__snippet" },
                                  r.snippet,
                              )
                            : null;
                        const position = Number.isFinite(r.position)
                            ? `#${r.position}`
                            : null;
                        const date = r.date
                            ? el("span", { class: "muted" }, ` • ${r.date}`)
                            : null;

                        const item = el(
                            "div",
                            { class: "mg-result" },
                            el("h2", { class: "mg-result__title" }, titleLink),
                            meta,
                            el(
                                "div",
                                {
                                    style: "display:flex; gap:8px; align-items:center; margin-top:6px;",
                                },
                                position
                                    ? el("span", { class: "muted" }, position)
                                    : null,
                                date,
                            ),
                            snippet,
                        );
                        results.appendChild(item);
                    });
                } else {
                    results.appendChild(el("div", {}, "No results"));
                }

                left.appendChild(results);

                // Related searches
                if (
                    Array.isArray(json.relatedSearches) &&
                    json.relatedSearches.length
                ) {
                    const relatedWrap = el("div", {
                        class: "mg-related",
                        "aria-label": "Related searches",
                    });
                    json.relatedSearches.forEach((rs) => {
                        const q = rs.query || rs;
                        const chip = el(
                            "a",
                            {
                                class: "mg-chip",
                                href: `https://www.google.com/search?q=${encodeURIComponent(q)}`,
                                target: "_blank",
                                rel: "noopener noreferrer",
                            },
                            q,
                        );
                        relatedWrap.appendChild(chip);
                    });
                    left.appendChild(
                        el(
                            "div",
                            { style: "margin-top: 14px" },
                            el("h4", { class: "muted" }, "Related searches"),
                            relatedWrap,
                        ),
                    );
                }

                // Right column: Knowledge Graph
                const right = el("aside", {
                    class: "mg-knowledge",
                    "aria-label": "Knowledge panel",
                });
                const kg = json.knowledgeGraph || {};
                const kgHeader = el(
                    "div",
                    { style: "display:flex; gap:12px; align-items:center;" },
                    kg.imageUrl
                        ? el("img", {
                              class: "mg-knowledge__img",
                              src: kg.imageUrl,
                              alt: kg.title || "Image",
                          })
                        : null,
                    el(
                        "div",
                        {},
                        el(
                            "div",
                            { class: "mg-knowledge__title" },
                            kg.title || "",
                        ),
                        kg.descriptionSource
                            ? el(
                                  "div",
                                  { class: "muted", style: "font-size:13px" },
                                  `${kg.descriptionSource}`,
                              )
                            : null,
                    ),
                );
                right.appendChild(kgHeader);

                if (kg.description) {
                    const desc = el(
                        "p",
                        { class: "mg-knowledge__desc" },
                        kg.description + (kg.descriptionLink ? " " : ""),
                    );
                    if (kg.descriptionLink) {
                        const sourceA = el(
                            "a",
                            {
                                href: kg.descriptionLink,
                                target: "_blank",
                                rel: "noopener noreferrer",
                            },
                            "More",
                        );
                        desc.appendChild(sourceA);
                    }
                    right.appendChild(desc);
                }

                // Attributes (dl)
                if (kg.attributes && typeof kg.attributes === "object") {
                    const dl = el("dl", { class: "mg-knowledge__attributes" });
                    Object.entries(kg.attributes).forEach(([k, v]) => {
                        dl.appendChild(el("dt", {}, k));
                        dl.appendChild(el("dd", {}, v));
                    });
                    right.appendChild(dl);
                }

                grid.appendChild(left);
                grid.appendChild(right);
                container.appendChild(grid);

                // attach or return
                if (containerId) {
                    const host = document.getElementById(containerId);
                    if (host) {
                        host.innerHTML = "";
                        host.appendChild(container);
                        return host;
                    } else {
                        console.warn(
                            "renderGoogleMock: containerId not found, returning node instead.",
                        );
                    }
                }
                return container;
            }

            document.addEventListener("DOMContentLoaded", () => {
                try {
                    const params = new URLSearchParams(window.location.search);
                    const dataParam = params.get("data");
                    const qParam = params.get("q");
                    let payload;
                    if (dataParam) {
                        const jsonStr = atob(dataParam);
                        const parsed = JSON.parse(jsonStr);
                        if (parsed && typeof parsed === "object")
                            payload = parsed;
                    }
                    renderGoogleMock(payload, { containerId: "app" });
                } catch (e) {
                    console.warn("Failed to parse inline data:", e);
                }

                // prevent search input changes
                const searchInput = document.querySelector(
                    ".mg-searchbox input",
                );
                if (searchInput) {
                    searchInput.addEventListener("change", (e) => {
                        e.preventDefault();
                    });
                }
            });
        </script>
    </body>
</html>
